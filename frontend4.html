<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>多裝置環境資訊與控制面板4</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { padding: 10px; }
.device { margin-bottom: 10px; }
.led { width: 20px; height: 20px; border-radius: 50%; display: inline-block; margin-right: 5px; cursor:pointer; }
.status { font-weight: bold; margin-left: 5px; }
.table td, .table th { padding: 0.25rem; text-align:center; }

/* 設定全域變數值 */
.custom-striped {
  --odd-row-bg:   #f8bbd3; /* 淺粉色 */
  --odd-row-color:#b8860b;    
  --even-row-bg:  #e49ab8; /* 深粉色 */
  --even-row-color:#fff;   /* 白字 */
}

/* 奇數列：套用自訂變數 */
.custom-striped > tbody > tr:nth-of-type(odd) > * {
  --bs-table-accent-bg: var(--odd-row-bg) !important;
  color: var(--odd-row-color)!important;
}

/* 偶數列：同樣用變數 */
.custom-striped > tbody > tr:nth-of-type(even) > * {
  --bs-table-accent-bg: var(--even-row-bg)!important;
  color: var(--even-row-color)!important;
}

.table-bordered { border-color: #ffb366; } /* 橘色邊框 */
.table th, .table td { color: #b8860b; font-weight: bold; } /* 金色字 */
.status-text { color: #28a745; font-weight:bold; }
.status-disconnect { color: #dc3545; font-weight:bold; }
button { margin:2px; }
</style>
</head>
<body>
<h2>多裝置控制面板</h2>

<div class="mb-2 d-flex flex-wrap align-items-center">
  <button id="disconnect" class="btn btn-warning btn-sm">斷線</button>
  <button id="reconnect" class="btn btn-success btn-sm">連線</button>
  <button id="all_on" class="btn btn-primary btn-sm">全開</button>
  <button id="all_off" class="btn btn-secondary btn-sm">全關</button>
  <span>狀態: <span id="connection_status" class="status status-text">已連線</span></span>
</div>

<div id="devices"></div>

<div class="mt-3">
  <h3>多裝置環境資訊面板</h3>
  <div class="table-responsive">
    <table class="table table-striped custom-striped table-bordered table-sm">
      <thead>
        <tr>
          <th>裝置</th>
          <th>溫度</th>
          <th>濕度</th>
          <th>時間</th>
        </tr>
      </thead>
      <tbody id="dht_body"></tbody>
    </table>
  </div>
</div>

<script>
const NUM_DEVICES = 8;
const NUM_LEDS = 7;
let connected = true;
const devicesDiv = document.getElementById("devices");
const connectionStatus = document.getElementById("connection_status");
let devicesStatus = {};

<!-- ...... -->

function toggleLED(device, led){
    if(!connected) return;
    const ledDiv = document.getElementById(`device${device}_led${led}`);
    const newVal = ledDiv.style.backgroundColor==="blue"?1:0;
    ledDiv.style.backgroundColor = newVal? "red":"blue";
    const payload = {};
    payload[`device${device}`] = {};
    for(let j=1;j<=NUM_LEDS;j++){
        payload[`device${device}`][`led${j}`] = j===led? newVal : (devicesStatus[`device${device}`]?devicesStatus[`device${device}`][`led${j}`]:0);
    }
    fetch("/control",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({devices: payload})
    })
}

document.getElementById("all_on").addEventListener("click",()=>{
    if(!connected) return;
    const payload = {};
    for(let i=1;i<=NUM_DEVICES;i++){
        payload[`device${i}`]={};
        for(let j=1;j<=NUM_LEDS;j++){
            payload[`device${i}`][`led${j}`]=1;
            document.getElementById(`device${i}_led${j}`).style.backgroundColor="red";
        }
    }
    fetch("/control",{method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({devices:payload})})
})

<!-- ...... -->

document.getElementById("disconnect").addEventListener("click",()=>{
    connected=false; 
    connectionStatus.textContent="已斷線";
    connectionStatus.className="status status-disconnect";
    updateLEDsBlack();
    document.getElementById("dht_body").innerHTML='<tr><td colspan="4">斷線</td></tr>';
})




pollStatus();
</script>
</body>
</html>
